<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="GM + ?" />

<meta name="date" content="2015-07-07" />

<title>T-cell dynamics</title>




<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">T-cell dynamics</h1>
<h4 class="author"><em>GM + ?</em></h4>
<h4 class="date"><em>2015-07-07</em></h4>
</div>


<div id="using-mixed-models-to-fit-t-cell-dynamic-models" class="section level2">
<h2>Using mixed models to fit T-cell dynamic models</h2>
<p>Subjects are observed at a number of occasions at different times. On each occasion the densities of cells of five different types are recorded.</p>
<p>The process for these five types, <span class="math">\(N, S, C, T\)</span> and <span class="math">\(E\)</span>, are modelled as follows:</p>
<p><span class="math">\[\begin{aligned}
  {N_{t + 1}} =  &amp; {N_t} + {B_t} - N_t^d - N_t^t \\ 
  {S_{t + 1}} =  &amp; {S_t} + N_t^t - S_t^d - S_t^t \\ 
  {C_{t + 1}} =  &amp; {C_t} + S_t^t - C_t^d - C_t^t \\ 
  {T_{t + 1}} =  &amp; {T_t} + C_t^t - T_t^d - T_t^t \\ 
  {E_{t + 1}} =  &amp; {E_t} + T_t^t - E_t^d \\ 
\end{aligned} \]</span></p>
<p>where</p>
<ol style="list-style-type: decimal">
<li><span class="math">\(X_t^d\)</span> represents the number of cells of type <span class="math">\(X\)</span> that die between time <span class="math">\(t\)</span> and time <span class="math">\(t+1\)</span>,</li>
<li><span class="math">\(X_t^t\)</span> represents the number of cells of type <span class="math">\(X\)</span> that transition to the next type,</li>
<li><span class="math">\(B_t\)</span> represents the number of new cells of type <span class="math">\(N\)</span>.</li>
</ol>
<p>Letting <span class="math">\(d_t = \tau_{t+1} - \tau_t\)</span> be the number of units of time elapsed between the observations at times <span class="math">\(\tau_t\)</span> and <span class="math">\(\tau_{t+1}\)</span>, the hypothetical distribution of each component is:</p>
<p><span class="math">\[\begin{aligned}
  {B_t}\sim &amp; Poisson(\lambda d_t) \\
  N_t^d\sim &amp; Poisson\left( {{N_t}{\delta _N d_t}} \right)\\
  N_t^t\sim &amp; Poisson\left( {{N_t}{\psi _N} d_t} \right)\\
  S_t^d\sim &amp; Poisson\left( {{S_t}{\delta _S} d_t} \right) \\
  S_t^t\sim &amp; Poisson\left( {{S_t}{\psi _S} d_t} \right)  \\
  C_t^d\sim &amp; Poisson\left( {{C_t}{\delta _C} d_t} \right) \\
  C_t^t\sim &amp; Poisson\left( {{C_t}{\psi _C} d_t} \right) \\
  T_t^d\sim &amp; Poisson\left( {{T_t}{\delta _T} d_t} \right)\\
  T_t^t\sim &amp; Poisson\left( {{C_t}{\psi _T} d_t} \right) \\
  E_t^d\sim &amp; Poisson\left( {{E_t}{\delta _E} d_t} \right)  \\
\end{aligned} \]</span></p>
<p>This model has ten parameters: <span class="math">\(\lambda\)</span> representing the expected number of new cells of type <span class="math">\(N\)</span> per unit of time, and nine parameters of the form <span class="math">\(\delta_X, \psi_X\)</span>, representing the probability of death or transition per cell per unit of time.</p>
<p>If <span class="math">\(d_t\)</span> is almost constant, it can be be omitted in the model. For simplicity, it is omitted in the following formulas.</p>
<p>The values of some or all of these parameters are expected to vary from subject to subject. Using a mixed model in which the parameters are random allows this feature to be include in modeling.</p>
<p>The model should be accurate if the number of dying and transitioning cells of each type is relatively small compared with the total number of cells of that type within each observed time period. In this case, it may also be reasonable to assume that the <span class="math">\(B_t, N_t^d, N_t^t, ...\)</span> components are independent within occasion <span class="math">\(t\)</span> and sequentially conditionally independent, i.e. the distribution of <span class="math">\(B_t |N_t\)</span> is independent of the distribution of <span class="math">\(B_{t+1}|N_{t+1}\)</span>, etc.</p>
<p>The change in cell counts between occasions is: <span class="math">\[\Delta \left[ {\begin{array}{*{20}{c}}
  {{N_{t + 1}}} \\ 
  {{S_{t + 1}}} \\ 
  {{C_{t + 1}}} \\ 
  {{T_{t + 1}}} \\ 
  {{E_{t + 1}}} 
\end{array}} \right] = A \left[ {\begin{array}{*{20}{c}}
  {{B_t}} \\ 
  {N_t^d} \\ 
  {N_t^t} \\ 
  {S_t^d} \\ 
  {S_t^t} \\ 
  {C_t^d} \\ 
  {C_t^t} \\ 
  {T_t^d} \\ 
  {T_t^t} \\ 
  {E_t^d} 
\end{array}} \right]\]</span> where <span class="math">\[A = \left[ {\begin{array}{*{20}{c}}
  1&amp;{ - 1}&amp;{ - 1}&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0 \\ 
  0&amp;0&amp;1&amp;{ - 1}&amp;{ - 1}&amp;0&amp;0&amp;0&amp;0&amp;0 \\ 
  0&amp;0&amp;0&amp;0&amp;1&amp;{ - 1}&amp;{ - 1}&amp;0&amp;0&amp;0 \\ 
  0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;{ - 1}&amp;{ - 1}&amp;0 \\ 
  0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;{ - 1} 
\end{array}} \right]\]</span> The expectation of the change in cell counts is: <span class="math">\[E\left( {\Delta \left[ {\begin{array}{*{20}{c}}
  {{N_{t + 1}}} \\ 
  {{S_{t + 1}}} \\ 
  {{C_{t + 1}}} \\ 
  {{T_{t + 1}}} \\ 
  {{E_{t + 1}}} 
\end{array}} \right]} \right) = \left[ {\begin{array}{*{20}{c}}
  {\lambda  - {\delta _N}{N_t} - {\psi _N}{N_t}} \\ 
  {{\psi _N}{N_t} - {\delta _S}S - {\psi _S}{S_t}} \\ 
  {{\psi _S}{S_t} - {\delta _C}{C_t} - {\psi _C}{C_t}} \\ 
  {{\psi _C}{C_t} - {\delta _T}{T_t} - {\psi _T}{T_t}} \\ 
  {{\psi _T}{T_t} - {\delta _E}{E_t}} 
\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}
  {\lambda  - {N_t}\left( {{\delta _N} + {\psi _N}} \right)} \\ 
  {{\psi _N}{N_t} - {S_t}\left( {{\delta _S} + {\psi _S}} \right)} \\ 
  {{\psi _S}{S_t} - {C_t}\left( {{\delta _C} + {\psi _C}} \right)} \\ 
  {{\psi _C}{C_t} - {T_t}\left( {{\delta _T} + {\psi _T}} \right)} \\ 
  {{\psi _T}{T_t} - {\delta _E}{E_t}} 
\end{array}} \right] 
\]</span> and the variance-covariance matrix is <span class="math">\[\operatorname{Var} \left( {\Delta \left[ {\begin{array}{*{20}{c}}
  {{N_{t + 1}}} \\ 
  {{S_{t + 1}}} \\ 
  {{C_{t + 1}}} \\ 
  {{T_{t + 1}}} \\ 
  {{E_{t + 1}}} 
\end{array}} \right]} \right) = A\left[ {diag\left( {\begin{array}{*{20}{c}}
  \lambda &amp;{{\delta _N}{N_t}}&amp;{{\psi _N}{N_t}}&amp;{{\delta _S}{S_t}}&amp;{{\psi _S}{S_t}}&amp;{{\delta _C}{C_t}}&amp;{{\psi _C}{C_t}}&amp;{{\delta _T}{T_t}}&amp;{{\psi _T}{T_t}}&amp;{{\delta _E}{E_t}} 
\end{array}} \right)} \right]A'\]</span></p>
<p><span class="math">\[ = \left[ {\begin{array}{*{20}{c}}
  {\lambda  + {N_t}\left( {{\delta _N} + {\psi _N}} \right)}&amp;{ - {\psi _N}{N_t}}&amp;0&amp;0&amp;0 \\ 
  { - {\psi _N}{N_t}}&amp;{{\psi _N}{N_t} + {S_t}\left( {{\delta _S} + {\psi _S}} \right)}&amp;{ - {\psi _S}{S_t}}&amp;0&amp;0 \\ 
  0&amp;{ - {\psi _S}{S_t}}&amp;{{\psi _S}{S_t} + {C_t}\left( {{\delta _C} + {\psi _C}} \right)}&amp;{ - {\psi _C}{C_t}}&amp;0 \\ 
  0&amp;0&amp;{ - {\psi _C}{C_t}}&amp;{{\psi _C}{C_t} + {T_t}\left( {{\delta _T} + {\psi _T}} \right)}&amp;{ - {\psi _T}{T_t}} \\ 
  0&amp;0&amp;0&amp;{ - {\psi _T}{T_t}}&amp;{{\psi _T}{T_t} + {\delta _E}{E_t}} 
\end{array}} \right]\]</span></p>
<p>This formulation of the model allows an unconstrained parametrization by using the log of each parameter, each of which is positive, as the actual working parameter for optimization.</p>
</div>
<div id="using-mixed-models" class="section level2">
<h2>Using mixed models</h2>
<p>In most applications of mixed models, there is a univariate response variable whose expectation is determined by a linear model some of whose coefficients are fixed unknown parameters and others vary randomly from cluster to cluster. The model for the variance of the random parameters can be selected from a limited number of possibilies. Within each cluster, responses are independent with the same conditional within cluster variance for all observations.</p>
<p>This application is particularly interesting in that none of these common assumptions are reasonable.</p>
<p>The response is multivariate (the five cell types) and the variance is different at each occasion depending on parameters of the expectation model.</p>
<p>Few packages have the flexibility to accomodate these issues. The ‘nlme’ package has facilities to deal with:</p>
<ol style="list-style-type: decimal">
<li>Different models for the variance of random parameters: However it does not include models that would be reasonable for this kind of problem. A full free variance model would have too many parameters so that some independence assumptions are necessary. However, the only such model readily available in ‘nlme’ forces independence from the intercept random effect which imposes a very unrealistic assumption on the model.</li>
<li>Variances that vary depending on a fixed covariate or on the expected value of the response: However, there is no provision for variance that depends in a complex way on parameters of the linear model that are estimated iteratively in fitting the model.</li>
<li>Correlations between responses: However, again, there is no provision for correlations that depend on linear parameters nor for the type of correlation pattern in this problem.</li>
</ol>
<p>The virtue of ‘nlme’ is that its source is open and it is possible to create new ‘methods’ to implement models for the random parameter variance, the conditional response variance and the within-occasion response covariances that occur in this model.</p>
<p>The first part, which was more ‘theoretically’ challenging is complete. The other two parts are well under way.</p>
<p>The software to implement this is being built in a R package called ‘Tcells’ on github. It can be installed in R with the following commands:</p>
<pre><code>install.packages('devtools')
library(devtools)
install_github('gmonette/Tcells')
library(Tcells)</code></pre>
<p>Since package is being developed it is good practice to reinstall it frequently.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
